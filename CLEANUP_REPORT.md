# Repository Cleanup Report

**Date**: 2025-01-28  
**Repository**: proof-approval  
**Auditor**: Staff Engineer Repo Hygiene Audit

## Summary

This cleanup identified and addressed duplicate directory structures, orphaned files, and build artifacts that were committed to the repository. The primary issue was a duplicate `/src/` folder structure that was never integrated into the build pipeline.

## Changes Made

### 1. Quarantined Items (Moved to `/_quarantine/`)

| Item | Type | Reason |
|------|------|--------|
| `/src/` | Directory | Duplicate app structure - not referenced anywhere, not in tsconfig paths, not in tailwind.config.ts content array |
| `/admin/` | Directory | Orphaned folder at root - contains older versions of files that exist in `/app/admin/orders/` |
| `/globals.css` | File | Root-level duplicate - `/app/globals.css` is the active one (imported in `/app/layout.tsx`) |

### 2. Removed Items (Build Artifacts)

| Item | Reason |
|------|--------|
| `tsconfig.tsbuildinfo` | TypeScript build cache - should be .gitignored (and is) |
| `next-env.d.ts` | Auto-generated by Next.js - should be .gitignored (and is) |

### 3. Updated Files

| File | Change |
|------|--------|
| `.gitignore` | Removed `package-lock.json` from ignore list (reproducible builds); Added `_quarantine/` to ignore list |
| `.eslintrc.json` | Created with `next/core-web-vitals` config (was missing) |
| `app/p/[token]/ProofPortal.tsx` | Fixed unescaped apostrophe (lint error) |
| `app/p/[token]/ProofPortalClient.tsx` | Fixed unescaped apostrophe (lint error) |

### 4. No Changes Needed

| Item | Status |
|------|--------|
| `next.config.mjs` | Single config, correct |
| `tsconfig.json` | Single config, correct path mapping |
| `tailwind.config.ts` | Single config, correct content paths |
| `postcss.config.mjs` | Single config, correct |
| `vercel.json` | Single config, correct |
| `package-lock.json` | Single lockfile, kept (npm used) |
| `/app/` | Active App Router directory |
| `/components/` | Active components (used by `/app`) |
| `/lib/` | Active utilities (auth, supabase, rate-limit, validation) |

## Evidence for Decisions

### Why `/src/` is Dead Code

1. **Import Analysis**: `grep -r "@/src" .` returns no results
2. **tsconfig.json Paths**: Maps `@/*` to `./*` (root), not `./src/*`
3. **tailwind.config.ts**: Content includes `./app/**` and `./components/**` only
4. **Build Output**: Next.js build did not include any routes from `/src/app/`
5. **Feature Comparison**: 
   - `/app/layout.tsx` has `ToastProvider`; `/src/app/layout.tsx` does not
   - `/lib/` has auth.ts, rate-limit.ts, validation.ts; `/src/lib/` only has supabase.ts
   - `/components/` has ShipStation components; `/src/components/` does not

### Why Root `/admin/` is Dead Code

1. **Import Analysis**: `grep -r "@/admin" .` returns no results
2. **Location**: Not a valid Next.js App Router path (should be under `/app/`)
3. **Content**: Contains `OrdersLoading` inline component that was refactored to `/app/admin/orders/loading.tsx`
4. **Build Output**: Next.js did not process this folder

### Why Root `/globals.css` is Dead Code

1. **Import Analysis**: Not imported anywhere
2. **Active CSS**: `/app/layout.tsx` imports `./globals.css` (resolves to `/app/globals.css`)
3. **Content Comparison**: `/app/globals.css` has additional animation utilities

## Verification Commands Run

```bash
# Install dependencies
npm ci
# Result: Success (431 packages)

# Build (with placeholder .env.local)
npm run build
# Result: Success - 38 routes generated

# Lint
npm run lint
# Result: Only warnings (img elements, useEffect deps) - no errors
```

## Directory Structure After Cleanup

```
proof-approval/
├── app/                    # Next.js App Router (ACTIVE)
│   ├── admin/              # Admin dashboard
│   ├── api/                # API routes
│   ├── login/              # Login page
│   ├── p/[token]/          # Public proof portal
│   ├── globals.css         # Active CSS
│   ├── layout.tsx          # Root layout
│   └── page.tsx            # Home page
├── components/             # Shared components (ACTIVE)
├── lib/                    # Utilities (ACTIVE)
├── public/                 # Static assets
├── supabase/               # Database migrations
├── docs/                   # Documentation
├── _quarantine/            # Potentially unused items (for review)
└── [config files]          # next.config.mjs, tsconfig.json, etc.
```

## How to Restore Quarantined Items

If any quarantined items are actually needed:

```bash
# Restore all quarantined items
mv _quarantine/src ./src
mv _quarantine/admin ./admin
mv _quarantine/globals.css ./globals.css

# Update tailwind.config.ts if restoring /src:
# Add "./src/**/*.{ts,tsx}" to content array
```

## Recommendations

1. **Delete Quarantine After Verification**: Once the app is verified working in production, the `_quarantine/` folder can be permanently deleted.

2. **Consider ESLint Auto-fix**: Many of the remaining lint warnings (`<img>` → `<Image>`) could be fixed to improve performance.

3. **Add Pre-commit Hooks**: Consider adding husky + lint-staged to prevent future build artifacts from being committed.

4. **Documentation Consolidation**: There are many markdown guides at root level. Consider moving to `/docs/`:
   - DEPLOYMENT_GUIDE.md, DEPLOYMENT_GUIDE_V2.md
   - FEATURE_MAP.md, FEATURES_V4.md
   - FIXES_GUIDE.md, SECURITY_FIXES.md
   - etc.

## Risk Assessment

| Change | Risk Level | Mitigation |
|--------|------------|------------|
| Quarantine `/src/` | Low | No imports reference it; kept in quarantine for recovery |
| Quarantine `/admin/` | Low | No imports reference it; kept in quarantine for recovery |
| Quarantine root `globals.css` | Low | Not imported; `/app/globals.css` is superset |
| Remove build artifacts | None | Auto-regenerated on build |
| Fix lint errors | None | Corrected actual bugs (unescaped entities) |
